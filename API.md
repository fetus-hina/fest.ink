fest.ink API
============

fest.inkと同等のサイトを構築できるであろうAPIを公開しています。

ご自由にお使いいただけますが、次の点にご留意ください。

* APIの仕様は突然変更になる（互換性が失われる）可能性があります。フェス中には変更しません。
* APIはfest.ink用に作成/使用しているものをそのまま流用しています。
    - このAPIの目的はあくまでfest.ink用が第一です。負荷状況等に応じて遮断する可能性があります。
    - このAPIにクライアントのブラウザから直接アクセスするのは避けてください。
        - ある程度キャッシュすることで負荷軽減にご協力ください。データはそれほど頻繁には更新されません。
        - 現在のところ `Access-Control-Allow-Origin` の設定など、CORSに対応する設定を行うことは考えていません。
* 単にTwitterに勝率をながすだけなら、[@ikafest](https://twitter.com/ikafest) があります。

日時型は、UNIX時間を秒精度で整数型に格納して表します。ほとんどのプログラミング言語ではUNIX時間を取り扱えるはずです。
JavaScriptで取り扱う場合は、1000倍してください。（例：`new Date(at * 1000)`、JavaScriptではミリ秒単位のため）

文字列の電文上の表現はJSONで許容された全ての表現になり得ます。
つまり、非ASCII文字その他ほとんど全ての文字はエスケープを用いた表現(e.g. `\\` `\/` `\u3042`)になり得ます。
「なんちゃってパーサ」ではなく、きちんとRFC 7159(あるいはRFC 4627)に対応したパーサを通してください。

----

## GET /index.json ##

[`GET https://fest.ink/index.json`](https://fest.ink/index.json)

フェスに関する情報と提供元サイトに関する情報を返します。

```js
{
  // 取得日時（サーバ側時刻）、UNIX時間で秒単位、小数点以下あり。
  "now":1442147020.9321,
  
  // "now" を ISO 8601 で表現したもの。小数点以下あり。小数点はドット。時間帯はパラメータ参照。
  "now_s":"2015-09-13T21:23:40.932145+09:00",
  
  // このJSONを提供したシステムの情報。特に表示義務等はありません。ただの参考情報です。
  "source":{
    "name":"イカフェスレート",
    "url":"https://fest.ink/",
    "version":"2.0.0-dev",
    "revision":["9a7e5668ed4a92c84725484949471f7a4708240e","9a7e566"] // Gitリビジョンのフルと短縮表記
  },

  // フェスの一覧
  "fests":[
    {
      // id は第 "n" 回と一致。/:id.json の呼び出しにも使います。
      "id":5,

      // フェス名称
      "name":"ボケ vs ツッコミ",

      // 開催期間
      "term":{
        // 開始・終了日時を UNIX 時間で秒単位。
        "begin":1442026800,
        "end":1442113200,

        // "begin"/"end" を ISO 8601 で表現したもの。時間帯はパラメータ参照。
        "begin_s":"2015-09-12T12:00:00+09:00",
        "end_s":"2015-09-13T12:00:00+09:00",

        // 呼び出し時点のフェスの状態
        //   "scheduled"  : 開催前
        //   "in session" : 開催中
        //   "closed"     : 開催終了
        "status":"closed",

        // 開催中なら true （"status" == "in session")
        "in_session":false
      },

      // 両陣営の情報
      "teams":{
        // アルファチーム = アオリ側チーム
        "alpha":{
          // チーム名
          "name":"ボケ",

          // インク色。RRGGBB。大文字小文字は期待しないでください。適当に設定したもので null の場合もあります。
          "ink":"d9612b"
        },

        // ブラボーチーム = ホタル側チーム
        "bravo":{
          "name":"ツッコミ",
          "ink":"5c7cb8"
        }
      }
    },
    // ...
  ]
}
```

要素の出現順は一致しない可能性があります。また、フェスは開催順でない場合があり得るものと想定してください。（現在の実装上は新しいものから並びます）

### クエリパラメータ ###

* `tz` (e.g.: `https://fest.ink/index.json?tz=Europe%2fLondon`)

    日時の文字列表記のタイムゾーンを指定します。

    - デフォルトは `Asia/Tokyo` です
    - UTC(GMT) に設定する場合は `Etc/UTC` です
    - ほとんどの一般的な `地域/都市名` 表記が利用できます。具体的なリストは /timezone/list.json で取得できます。

----

## GET /:id.json ##

[`GET https://fest.ink/:id.json`](https://fest.ink/4.json)

指定されたフェスの情報を返します。サンプリングされた勝ち数も含まれます。（fest.inkのフェスページに表示される内容はこのJSONから全て求められます）

```js
{
  // index.json と内容が同じものは省略します
  "now":1442147721.5703,
  "now_s":"2015-09-13T21:35:21.570301+09:00",
  "id":5,
  "name":"ボケ vs ツッコミ",
  "term":{
    "begin":1442026800,
    "end":1442113200,
    "begin_s":"2015-09-12T12:00:00+09:00",
    "end_s":"2015-09-13T12:00:00+09:00",
    "in_session":false,
    "status":"closed"
  },
  "teams":{
    "alpha":{
      "name":"ボケ",
      "ink":"d9612b"
    },
    "bravo":{
      "name":"ツッコミ",
      "ink":"5c7cb8"
    }
  },

  // 各タイミングでの各チームのサンプリング済みの勝利数の配列
  "wins":[
    {
      // サンプリング日時（厳密にはこの少し前の任天堂次第のタイミング）
      "at":1442027042,
      "at_s":"2015-09-12T12:04:02+09:00",

      // 各陣営の勝利数
      // 概ね合計が90前後になるように見えますが一定しません。
      // サンプリング数の根拠も何もかも任天堂次第で謎です。
      "alpha":48,
      "bravo":43
    },
    // ...
  ]
}
```

要素の出現順は一致しない可能性があります。また、`wins`配列の中身は順不同と想定してください。（時系列で何かしたければ`at`を使用して並び替えてください）

なお、fest.ink のフェスページで表示している推定勝率は、

```
ALPHA = TOTAL(wins.alpha) / { TOTAL(wins.alpha) + TOTAL(wins.bravo) }
BRAVO = TOTAL(wins.bravo) / { TOTAL(wins.alpha) + TOTAL(wins.bravo) }
```

です。

### クエリパラメータ ###

* `tz` (e.g.: `https://fest.ink/5.json?tz=Europe%2fLondon`)

    日時の文字列表記のタイムゾーンを指定します。

    - デフォルトは `Asia/Tokyo` です
    - UTC(GMT) に設定する場合は `Etc/UTC` です
    - ほとんどの一般的な `地域/都市名` 表記が利用できます。具体的なリストは /timezone/list.json で取得できます。

----

## GET /timezone/list.json ##

[`GET https://fest.ink/timezone/list.json`](https://fest.ink/timezone/list.json)

各 API に指定することができるタイムゾーン設定のリストです。

省略しているタイムゾーンがあります。また、そもそも利用することを想定した仕組みではないためレスポンスの構成は適当です。
ユーザフレンドリーな都市名表記を行いたい場合は自前で頑張ってください（例えば `Asia/Tokyo` を "東京" と表示するなど）。

```js
{
  "zones":[
    {"zone":"Africa/Abidjan"},
    {"zone":"Africa/Accra"},
    {"zone":"Africa/Addis_Ababa"},
    {"zone":"Africa/Algiers"},
    //...
  ]
}
```
