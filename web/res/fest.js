!function(t,e){"use strict";var n=t.jQuery,a=Number.NaN,r=6e5;n(t.document).ready(function(){var i=n(".container[data-fest]").attr("data-fest");if((i+"").match(/^\d+$/)){var u=n("#btn-update"),o=n("#btn-autoupdate"),l=n("#dropdown-update-interval"),s=n(".total-rate"),c=n(".sample-count"),d=n(".total-progressbar"),f=n(".rate-graph"),m=n(".last-updated-at"),h=n(".last-fetched-at"),v=t.localStorage,g=!!v,p=function(t){g&&v.setItem("autoupdate",t?"enabled":"disabled")},b=function(){if(g){var t=v.getItem("autoupdate");if("disabled"===t)return!1}return!0},w=null,N=null,x=function(t){g&&v.setItem("update-interval",~~t)},y=function(){if(g){var t=v.getItem("update-interval");if((t+"").match(/^\d+$/))return~~t}return r},S=function(){var t=function(t){return t.toString().replace(/([\d]+?)(?=(?:\d{3})+$)/g,function(t){return t+","})},r=function(t){for(var e=0,n=0,r=0;r<t.wins.length;++r)e+=t.wins[r].r,n+=t.wins[r].g;var i=e+n;return{r:i>0?e/i:a,g:i>0?n/i:a,rSum:i>0?e:a,gSum:i>0?n:a}},o=function(t){s.each(function(){var r=n(this),i=function(){switch(r.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return a}}();r.text(i===e||isNaN(i)?"???":Math.round(1e3*i)/10+"%")})},l=function(e){c.text(isNaN(e.rSum)||isNaN(e.gSum)?"???":t(e.rSum+e.gSum))},v=function(t){d.each(function(){var r=n(this),i=function(){switch(r.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return a}}();r.width(i===e||isNaN(i)?"0%":100*i+"%")})},g=function(t){return{series:{stack:!0,lines:{show:!0,fill:!0,steps:!1}},xaxis:{mode:"time",minTickSize:[30,"minute"],timeformat:"%H:%M",twelveHourClock:!1,timezone:"browser",min:1e3*t.begin,max:1e3*t.end},yaxis:{min:0,max:100},colors:["#d9435f","#5cb85c"]}},p=function(t){var e=f.filter(".rate-graph-short");if(e.length>0){for(var a=[],r=[],i=0;i<t.wins.length;++i){var u=t.wins[i];u.r+u.g>0&&(a.push([1e3*u.at,100*u.r/(u.r+u.g)]),r.push([1e3*u.at,100*u.g/(u.r+u.g)]))}e.each(function(){var e=n(this);e.empty(),n.plot(e,[a,r],g(t.term))})}},b=function(t){var e=f.filter(".rate-graph-whole");if(e.length>0){var a=t.wins.slice(0);a.sort(function(t,e){return t.at-e.at});for(var r=0,i=0,u=[],o=[],l=0;l<a.length;++l){var s=a[l];r+=s.r,i+=s.g,r+i>0&&(u.push([1e3*s.at,100*r/(r+i)]),o.push([1e3*s.at,100*i/(r+i)]))}e.each(function(){var e=n(this);e.empty(),n.plot(e,[u,o],g(t.term))})}},w=function(t,n){var a=function(t){var e=function(t){return t=~~t,(t>9?"":"0")+t};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())},r=Math.max.apply(null,n.wins.map(function(t){return t.at}));m.text(1>r||r===e||isNaN(r)?"???":a(new Date(1e3*r))),h.text(a(t))},N=new Date;u.attr("disabled","disabled"),n.getJSON("/"+encodeURIComponent(i)+".json",{_t:Math.floor(N/1e3)},function(t){var e=r(t);o(e),v(e),l(e),p(t),b(t),w(N,t),u.removeAttr("disabled")})},I=function(){o.removeClass("btn-default").addClass("btn-primary"),null!==w&&t.clearInterval(w),N=y(),w=t.setInterval(S,N),p(!0)},C=function(){o.addClass("btn-default").removeClass("btn-primary"),null!==w&&t.clearInterval(w),w=null,N=null,p(!1)};u.click(S),o.click(function(){n(this).hasClass("btn-primary")?C():(I(),S())}),g?(l.parent().on("show.bs.dropdown",function(){var t=null===N?y():N;n(".update-interval",l).each(function(){var e=n(this),a=n(".glyphicon",e),r=1e3*~~e.attr("data-interval");a.css("color",r===t?"#333":"rgba(0,0,0,0)")})}),n(".update-interval").click(function(){var t=1e3*~~n(this).attr("data-interval");N!==t&&(C(),x(t),I(),S())})):n("#btn-update-interval").attr("disabled","disabled"),o.each(b()?function(){I()}:function(){C()}),t.setTimeout(function(){S.call(t)},1)}})}(window);
