!function(t,e){"use strict";var n=t.jQuery,r=Number.NaN;n(t.document).ready(function(){var a=n(".container[data-fest]").attr("data-fest");if((a+"").match(/^\d+$/)){var i=n(".total-rate"),o=n(".total-progressbar"),u=n(".rate-graph"),s=n(".last-updated-at"),c=n(".last-fetched-at");if(!(i.length<1&&o.length<1&&u.length<1&&s.length<1&&c.length<1)){var f=function(){var t=function(t){for(var e=0,n=0,a=0;a<t.wins.length;++a)e+=t.wins[a].r,n+=t.wins[a].g;var i=e+n;return{r:i>0?e/i:r,g:i>0?n/i:r}},f=function(t){i.each(function(){var a=n(this),i=function(){switch(a.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return r}}();a.text(i===e||isNaN(i)?"???":Math.round(1e3*i)/10+"%")})},l=function(t){o.each(function(){var a=n(this),i=function(){switch(a.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return r}}();a.width(i===e||isNaN(i)?"0%":100*i+"%")})},h=function(t){return{series:{stack:!0,lines:{show:!0,fill:!0,steps:!1}},xaxis:{mode:"time",minTickSize:[30,"minute"],timeformat:"%H:%M",twelveHourClock:!1,timezone:"browser",min:1e3*t.begin,max:1e3*t.end},yaxis:{min:0,max:100},colors:["#d9435f","#5cb85c"]}},g=function(t){var e=u.filter(".rate-graph-short");if(e.length>0){for(var r=[],a=[],i=0;i<t.wins.length;++i){var o=t.wins[i];o.r+o.g>0&&(r.push([1e3*o.at,100*o.r/(o.r+o.g)]),a.push([1e3*o.at,100*o.g/(o.r+o.g)]))}e.each(function(){var e=n(this);e.empty(),n.plot(e,[r,a],h(t.term))})}},m=function(t){var e=u.filter(".rate-graph-whole");if(e.length>0){var r=t.wins.slice(0);r.sort(function(t,e){return t.at-e.at});for(var a=0,i=0,o=[],s=[],c=0;c<r.length;++c){var f=r[c];a+=f.r,i+=f.g,a+i>0&&(o.push([1e3*f.at,100*a/(a+i)]),s.push([1e3*f.at,100*i/(a+i)]))}e.each(function(){var e=n(this);e.empty(),n.plot(e,[o,s],h(t.term))})}},v=function(t,n){var r=function(t){var e=function(t){return t=~~t,(t>9?"":"0")+t};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())},a=Math.max.apply(null,n.wins.map(function(t){return t.at}));s.text(1>a||a===e||isNaN(a)?"???":r(new Date(1e3*a))),c.text(r(t))},d=new Date;n.getJSON("/"+encodeURIComponent(a)+".json",{_t:Math.floor(d/1e3)},function(e){var n=t(e);f(n),l(n),g(e),m(e),v(d,e)})};t.setTimeout(function(){f.call(t),t.setInterval(function(){f.call(t)},6e5)},1)}}})}(window);