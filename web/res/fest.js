!function(t,e){"use strict";var a=t.jQuery,n=Number.NaN,r=6e5,i="Asia/Tokyo";a(t.document).ready(function(){timezoneJS.timezone.zoneFileBasePath="/res/tz",timezoneJS.timezone.init();var u=function(t){return new timezoneJS.Date(t,i)},o=a(".container[data-fest]").attr("data-fest");if((o+"").match(/^\d+$/)){var s=a("#btn-update"),l=a("#btn-autoupdate"),c=a("#dropdown-update-interval"),d=a(".btn-graphtype"),f=a(".total-rate"),m=a(".sample-count"),p=a(".total-progressbar"),h=a(".rate-graph"),v=a(".last-updated-at"),g=a(".last-fetched-at"),b=t.localStorage,y=!!b,w=function(t){y&&b.setItem("autoupdate",t?"enabled":"disabled")},N=function(){if(y){var t=b.getItem("autoupdate");if("disabled"===t)return!1}return!0},S=null,C=null,k=function(t){y&&b.setItem("update-interval",~~t)},x=function(){if(y){var t=b.getItem("update-interval");if((t+"").match(/^\d+$/))return~~t}return r},I=function(t){y&&b.setItem("graph-type",t)},z=function(){if(y){var t=b.getItem("graph-type");if("overlay"===t)return t}return"stack"},M=function(){var t=function(t){return t.toString().replace(/([\d]+?)(?=(?:\d{3})+$)/g,function(t){return t+","})},r=function(t){for(var e=0,a=0,r=0;r<t.wins.length;++r)e+=t.wins[r].r,a+=t.wins[r].g;var i=e+a;return{r:i>0?e/i:n,g:i>0?a/i:n,rSum:i>0?e:n,gSum:i>0?a:n}},l=function(t){f.each(function(){var r=a(this),i=function(){switch(r.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return n}}();r.text(i===e||isNaN(i)?"???":Math.round(1e3*i)/10+"%")})},c=function(e){m.text(isNaN(e.rSum)||isNaN(e.gSum)?"???":t(e.rSum+e.gSum))},d=function(t){p.each(function(){var r=a(this),i=function(){switch(r.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return n}}();r.width(i===e||isNaN(i)?"0%":100*i+"%")})},b=function(t){return{series:{stack:"stack"===z(),lines:{show:!0,fill:!0,steps:!1}},xaxis:{mode:"time",minTickSize:[30,"minute"],timeformat:"%H:%M",twelveHourClock:!1,timezone:i,min:1e3*t.begin,max:1e3*t.end},yaxis:{min:0,max:100},colors:["#d9435f","#5cb85c"]}},y=function(t){var e=h.filter(".rate-graph-short");if(e.length>0){for(var n=[],r=[],i=0;i<t.wins.length;++i){var u=t.wins[i];u.r+u.g>0&&(n.push([1e3*u.at,100*u.r/(u.r+u.g)]),r.push([1e3*u.at,100*u.g/(u.r+u.g)]))}e.each(function(){var e=a(this);e.empty(),a.plot(e,[n,r],b(t.term))})}},w=function(t){var e=h.filter(".rate-graph-whole");if(e.length>0){var n=t.wins.slice(0);n.sort(function(t,e){return t.at-e.at});for(var r=0,i=0,u=[],o=[],s=0;s<n.length;++s){var l=n[s];r+=l.r,i+=l.g,r+i>0&&(u.push([1e3*l.at,100*r/(r+i)]),o.push([1e3*l.at,100*i/(r+i)]))}e.each(function(){var e=a(this);e.empty(),a.plot(e,[u,o],b(t.term))})}},N=function(t,a){var n=function(t){var e=function(t){return t=~~t,(t>9?"":"0")+t};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())},r=Math.max.apply(null,a.wins.map(function(t){return t.at}));v.text(1>r||r===e||isNaN(r)?"???":n(u(1e3*r))),g.text(n(t))},S=new Date;s.attr("disabled","disabled"),a.getJSON("/"+encodeURIComponent(o)+".json",{_t:Math.floor(S/1e3)},function(t){var e=r(t);l(e),d(e),c(e),y(t),w(t),N(u(S.getTime()),t),s.removeAttr("disabled")})},J=function(){l.removeClass("btn-default").addClass("btn-primary"),null!==S&&t.clearInterval(S),C=x(),S=t.setInterval(M,C),w(!0)},T=function(){l.addClass("btn-default").removeClass("btn-primary"),null!==S&&t.clearInterval(S),S=null,C=null,w(!1)},D=function(){d.addClass("btn-default").removeClass("btn-primary"),d.filter("*[data-type="+z()+"]").addClass("btn-primary").removeClass("btn-default")};s.click(M),l.click(function(){a(this).hasClass("btn-primary")?T():(J(),M())}),y?(c.parent().on("show.bs.dropdown",function(){var t=null===C?x():C;a(".update-interval",c).each(function(){var e=a(this),n=a(".glyphicon",e),r=1e3*~~e.attr("data-interval");n.css("color",r===t?"#333":"rgba(0,0,0,0)")})}),a(".update-interval").click(function(){var t=1e3*~~a(this).attr("data-interval");C!==t&&(T(),k(t),J(),M())}),d.click(function(){var t=a(this);t.hasClass("btn-primary")||(I(t.attr("data-type")),D(),M())})):(a("#btn-update-interval").attr("disabled","disabled"),d.attr("disabled","disabled")),N()?J():T(),D(),t.setTimeout(function(){M()},1)}a(".auto-tooltip").tooltip({container:"body"})})}(window);