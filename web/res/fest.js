!function(t,e){"use strict";var a=t.jQuery,n=Number.NaN,r=6e5;a(t.document).ready(function(){var i=a(".container[data-fest]").attr("data-fest");if((i+"").match(/^\d+$/)){var u=a("#btn-update"),s=a("#btn-autoupdate"),o=a("#dropdown-update-interval"),l=a(".btn-graphtype"),c=a(".total-rate"),d=a(".sample-count"),f=a(".total-progressbar"),m=a(".rate-graph"),p=a(".last-updated-at"),h=a(".last-fetched-at"),v=t.localStorage,g=!!v,b=function(t){g&&v.setItem("autoupdate",t?"enabled":"disabled")},w=function(){if(g){var t=v.getItem("autoupdate");if("disabled"===t)return!1}return!0},y=null,N=null,C=function(t){g&&v.setItem("update-interval",~~t)},x=function(){if(g){var t=v.getItem("update-interval");if((t+"").match(/^\d+$/))return~~t}return r},I=function(t){g&&v.setItem("graph-type",t)},S=function(){if(g){var t=v.getItem("graph-type");if("overlay"===t)return t}return"stack"},k=function(){var t=function(t){return t.toString().replace(/([\d]+?)(?=(?:\d{3})+$)/g,function(t){return t+","})},r=function(t){for(var e=0,a=0,r=0;r<t.wins.length;++r)e+=t.wins[r].r,a+=t.wins[r].g;var i=e+a;return{r:i>0?e/i:n,g:i>0?a/i:n,rSum:i>0?e:n,gSum:i>0?a:n}},s=function(t){c.each(function(){var r=a(this),i=function(){switch(r.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return n}}();r.text(i===e||isNaN(i)?"???":Math.round(1e3*i)/10+"%")})},o=function(e){d.text(isNaN(e.rSum)||isNaN(e.gSum)?"???":t(e.rSum+e.gSum))},l=function(t){f.each(function(){var r=a(this),i=function(){switch(r.attr("data-team")){case"red":return t.r;case"green":return t.g;default:return n}}();r.width(i===e||isNaN(i)?"0%":100*i+"%")})},v=function(t){return{series:{stack:"stack"===S(),lines:{show:!0,fill:!0,steps:!1}},xaxis:{mode:"time",minTickSize:[30,"minute"],timeformat:"%H:%M",twelveHourClock:!1,timezone:"browser",min:1e3*t.begin,max:1e3*t.end},yaxis:{min:0,max:100},colors:["#d9435f","#5cb85c"]}},g=function(t){var e=m.filter(".rate-graph-short");if(e.length>0){for(var n=[],r=[],i=0;i<t.wins.length;++i){var u=t.wins[i];u.r+u.g>0&&(n.push([1e3*u.at,100*u.r/(u.r+u.g)]),r.push([1e3*u.at,100*u.g/(u.r+u.g)]))}e.each(function(){var e=a(this);e.empty(),a.plot(e,[n,r],v(t.term))})}},b=function(t){var e=m.filter(".rate-graph-whole");if(e.length>0){var n=t.wins.slice(0);n.sort(function(t,e){return t.at-e.at});for(var r=0,i=0,u=[],s=[],o=0;o<n.length;++o){var l=n[o];r+=l.r,i+=l.g,r+i>0&&(u.push([1e3*l.at,100*r/(r+i)]),s.push([1e3*l.at,100*i/(r+i)]))}e.each(function(){var e=a(this);e.empty(),a.plot(e,[u,s],v(t.term))})}},w=function(t,a){var n=function(t){var e=function(t){return t=~~t,(t>9?"":"0")+t};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())},r=Math.max.apply(null,a.wins.map(function(t){return t.at}));p.text(1>r||r===e||isNaN(r)?"???":n(new Date(1e3*r))),h.text(n(t))},y=new Date;u.attr("disabled","disabled"),a.getJSON("/"+encodeURIComponent(i)+".json",{_t:Math.floor(y/1e3)},function(t){var e=r(t);s(e),l(e),o(e),g(t),b(t),w(y,t),u.removeAttr("disabled")})},M=function(){s.removeClass("btn-default").addClass("btn-primary"),null!==y&&t.clearInterval(y),N=x(),y=t.setInterval(k,N),b(!0)},D=function(){s.addClass("btn-default").removeClass("btn-primary"),null!==y&&t.clearInterval(y),y=null,N=null,b(!1)},H=function(){l.addClass("btn-default").removeClass("btn-primary"),l.filter("*[data-type="+S()+"]").addClass("btn-primary").removeClass("btn-default")};u.click(k),s.click(function(){a(this).hasClass("btn-primary")?D():(M(),k())}),g?(o.parent().on("show.bs.dropdown",function(){var t=null===N?x():N;a(".update-interval",o).each(function(){var e=a(this),n=a(".glyphicon",e),r=1e3*~~e.attr("data-interval");n.css("color",r===t?"#333":"rgba(0,0,0,0)")})}),a(".update-interval").click(function(){var t=1e3*~~a(this).attr("data-interval");N!==t&&(D(),C(t),M(),k())}),l.click(function(){var t=a(this);t.hasClass("btn-primary")||(I(t.attr("data-type")),H(),k())})):(a("#btn-update-interval").attr("disabled","disabled"),l.attr("disabled","disabled")),s.each(w()?function(){M()}:function(){D()}),H(),t.setTimeout(function(){k.call(t)},1)}})}(window);